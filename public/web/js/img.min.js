$(document).ready(function(){
$.showLoading('数据加载中');
$(".imgback").click(function(){
	window.history.go(-1);
})
var phone=getlocalStorage("phone");
if(phone==null||phone=="null"||phone==undefined||phone=="undefined"||phone==''){
	$.alert('登录失效,请重新登录!',function(){
		var v=Math.random();
		window.location.href="pre.html?v="+v;
	})
	return;
}
pageinit(ajaxurl);

function pageinit(ajaxurl){
   var phone=getlocalStorage("phone");
   var resultphone=getlocalStorage("resultphone");
   var titledata=getQueryStrings();
   if(titledata.url=='shake'){
   	console.log('查询进入');
   	phone=resultphone;
   	if(!hasdata(resultphone)){
   		$.alert('非法进入!');
   		return;
   	}
   }else{
   	 console.log('正常进入');
   }
   $.ajax({
		type:"post",
		url:ajaxurl+"/api/getImg",
		data:{
			"phone":phone
		},
		success:function(obj){
			console.log(obj)
			if(obj.code=="200"){
				makeimg(obj);
			}else{
				$.alert(obj.msg,function(){
					if(obj.msg=='登录失效,请重新登录'){
						window.history.go(-1);
					}else{
						window.location.href='index.html';
					}
				});
			}
		},
		error: function(jqXHR, textStatus, errorThrown) {
			$.hideLoading();
			$.alert("请检查您的网络，稍后再试！")
		}
	});
}	
function makeimg(obj){
	 var imgw = document.createElement("img");
	 imgw.src='img/imgbg2.jpg';	
	 console.log(imgw.src)
	 imgw.onload=function(){
	 	var can = document.getElementById("can");
        var cans = can.getContext('2d');
		// 将 img1 加入画布
		cans.drawImage(imgw,0,0,750,1234);
		var cname=obj.data.name;
		cans.fillStyle='#333';
        cans.font="22px Arial";
        cans.fillText(cname,274,339);
        
        var idCard=obj.data.idCard;
		cans.fillStyle='#333';
        cans.font="22px Arial";
        cans.fillText(idCard,274,376);
        
        var registration=obj.data.registration;
		cans.fillStyle='#333';
        cans.font="22px Arial";
        cans.fillText(registration,288,410);
        
		$("#can").hide();
		var c = document.getElementById('can');
        var d=c.toDataURL("image/jpg");
        $("#canimg").attr("src",d);
        $.hideLoading();
	 }
}		
})
