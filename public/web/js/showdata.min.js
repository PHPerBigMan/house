$(document).ready(function(){
$(".navboxc>div").click(function(){
	var v=$(this).attr("v");
	setlocalStorage('showdatanav',v);
	$(".navboxc>div").removeClass("active");
	$(this).addClass("active");
	$(".change1").hide();$(".change2").hide();
	$(".change"+v).show();
})
var showdatanav=getlocalStorage("showdatanav");
if(hasdata(showdatanav)){
	var v=showdatanav;
	$(".navboxc>div").removeClass("active");
	if(v==2){
		$(".navboxright").addClass("active");
	}else{
		$(".navboxleft").addClass("active");
	}
	$(".change1").hide();
	$(".change2").hide();
	$(".change"+v).show();
}
$(".loginoutin").click(function(){
		$.confirm({
		  title: '提示',
		  text: '退出后需重新登录,已完成的步骤将自动保存。',
		  onOK: function () {
		  	setlocalStorage('phone','');
		  	var v=Math.random();
		    window.location.href="login.html?v="+v;
		  },
		  onCancel: function () {
		  }
		});
})
var phone=getlocalStorage("phone")
if(phone==null||phone=="null"||phone==undefined||phone=="undefined"||phone==""){//判断登录
	$.alert('登录失效,请重新登录!',function(){
		var v=Math.random();
		window.location.href="login.html?v="+v;
	})
	return;
}
get1(posturl);
function get1(posturl){
$.ajax({
		url:posturl+"/api/get",
		type:"post",
		async:false,
		data:{
			"phone":phone,
			"type":1
		},
		success:function(obj){
			console.log(obj)
			if(obj.code==200){
				 if(obj.data.status=="审核中"||obj.data.status=="审核通过"||obj.data.status=="审核不通过"){
		          	$("body").attr("status",obj.data.status);
		          	
		          	console.log(obj.data.status);
		          }else{
		          	$(".headbox span").html(obj.data.status);
		          	$.alert(obj.data.status,function(){
						var v=Math.random();
		          	    window.location.href="index.html?v="+v;
					})
		          	return;
		          }
				 if(obj.data.divorce == null && obj.data.household == null && obj.data.hzHouse == null && obj.data.marriage == null && obj.data.otherHouse == null){
	                console.log('没有填写第一步的资料');
	                var v=Math.random();
	                window.location.href='index.html?v='+v;
				  }else{
						$(".marriage").html(obj.data.marriage);
						if(obj.data.otherHouse!=null){
							$(".nothzHouse").html(obj.data.otherHouse);	
						}else{
							$(".nothzHousebox").hide();	
						}
						if(obj.data.marriage=="离异单身(含带未成年子女)"){
							$(".divorce").html(obj.data.divorce);
							$(".marry").remove();
							$(".death").remove();
						}else{
							$(".divorcebox").hide();
							$('.divorce_img_box').remove();
						}
						get2();
				  }
			}else{
				$.alert(obj.msg,function(){
	            	if(obj.msg=='登录失效,请重新登录'){
						var v=Math.random();
					    window.location.href="login.html?v="+v;
				    }
	            });
			}
		},
		error:function(){
			$(".pagepre .btn").addClass("btnok");
            $.alert("请检查您的网络，稍后再试！","提示",function(){
            	
            })
		}
	});	
}
function get2(){
$.ajax({
		url:posturl+"/api/get",
		type:"post",
		async:false,
		data:{
			"phone":phone,
			"type":2
		},
		success:function(obj){
			console.log(obj)
			if(obj.code==200){
				if(obj.data.name==null){
				 	console.log('没有填写第二部分的资料');
				 	window.location.href="index2.html";
				 	return;
				 }
				$("body").attr("down",obj.data.down);
				$("body").attr("pay",obj.data.pay);
				$("body").attr("haveHouse",obj.data.haveHouse);
				$(".buyername").html(obj.data.name)	;
				$(".cardType").html(obj.data.cardType)	;
				$(".idCard").html(obj.data.idCard);
				$(".hasChild").html(obj.data.hasChild);
				$(".haveHouse").html(obj.data.haveHouse);	
				$(".nothzHouse").html(obj.data.nothzHouse);		
				$(".loan").html(obj.data.loan);	
				$(".down").html(obj.data.down);	
				$(".sale").html(obj.data.sale);
				$(".pay").html(obj.data.pay);		
				$("body").attr("other",obj.data.other.length);
				if(hasdata(obj.data.nothzHouse)){
					$(".nothzHouse").html(obj.data.nothzHouse);	
				}else{
					$(".nothzHousebox").hide();	
				}
				if(obj.data.child.length==0&&obj.data.other.length==0){
					$(".others").hide()
				}else{
					var str="";
					for (var i = 0; i < obj.data.child.length; i++) {
						str=str+'<p class="otherszoop">未成年子女信息</p><div class="otherszoobox"><div class="otherszooboxheader">未成年子女'+(i+1)+'</div>';
						str=str+'<div class="otherslinebox"><div class="otherslineboxleft">姓名</div><div class="otherslineboxright ">'+obj.data.child[i].name;
						str=str+'</div></div><div class="otherslinebox"><div class="otherslineboxleft">身份证号</div><div class="otherslineboxright ">'+obj.data.child[i].idCard+'</div></div></div>';
					}
					if(obj.data.child.length>0&&obj.data.other.length>0){
						str=str+'<hr class="hr" style="color: #efeff4;" />';
					}
					for (var i = 0; i < obj.data.other.length; i++) {
						if(i==0){
							var marriage=$(".marriage").text();
							if(marriage=="已婚"){
								str=str+'<p class="otherszoop">其他购房人信息</p><div class="otherszoobox"><div class="otherszooboxheader">其他购房人（配偶）</div>';
							}else{
								str=str+'<p class="otherszoop">其他购房人信息</p><div class="otherszoobox"><div class="otherszooboxheader">其他购房人'+(i+1)+'</div>';
							}
							
						}else{
							str=str+'<p class="otherszoop">其他购房人信息</p><div class="otherszoobox"><div class="otherszooboxheader">其他购房人'+(i+1)+'</div>';
						}
						
						str=str+'<div class="otherslinebox"><div class="otherslineboxleft">姓名</div><div class="otherslineboxright ">'+obj.data.other[i].name;
						str=str+'</div></div><div class="otherslinebox"><div class="otherslineboxleft">证件类型</div><div class="otherslineboxright ">'+obj.data.other[i].cardType+'</div></div>';
					    str=str+'<div class="otherslinebox"><div class="otherslineboxleft">身份证号</div><div class="otherslineboxright ">'+obj.data.other[i].idCard+'</div></div>'
					     str=str+'<div class="otherslinebox"><div class="otherslineboxleft">手机号码</div><div class="otherslineboxright ">'+obj.data.other[i].phone+'</div></div></div>'
					}
					
					
					$(".otherszoo").html(str);
					
					
				}
				if(obj.data.file.length==0){
					$(".houses").hide();
				}else{
					var str="";
					for (var i = 0; i < obj.data.file.length; i++) {
						str=str+'<div class="linebox"><div class="lineboxleft">查档编号'+(1+i)+'</div>';
						str=str+'<div class="lineboxright">'+obj.data.file[i]+'</div></div>'
					}
					$(".houseszoo").html(str);
				}
				get3(obj);
			}else{
				 $.alert(obj.msg,function(){
	            	if(obj.msg=='登录失效,请重新登录'){
						var v=Math.random();
					    window.location.href="login.html?v="+v;
				    }
	            });
			}
		},
		error:function(){
			$(".pagepre .btn").addClass("btnok");
            $.alert("请检查您的网络，稍后再试！","提示",function(){
            	
            })
		}
	});		
}	
function get3(ele){
$.ajax({
		url:posturl+"/api/get",
		type:"post",
		async:false,
		data:{
			"phone":phone,
			"type":3
		},
		success:function(obj){
			console.log(obj)
			if(obj.code==200){
				if(obj.data==null){
					console.log('没有填写第三部分的资料');
				 	window.location.href="index3.html";
				 	return;
				}else{
					if(obj.data.status=='资料没填完'){
						window.location.href="index.html";
				 	    return;
					}
				}
				var haveHouse=$("body").attr("haveHouse");
				$(".accountBook img").attr("src",obj.data.accountBook)
				$(".accountBookpersonal img").attr("src",obj.data.accountBookpersonal)
				$(".idCardfront img").attr("src",obj.data.idCardfront);
				$(".accountBookmain img").attr("src",obj.data.accountBookmain);
				$(".idCardback img").attr("src",obj.data.idCardback)
				if(obj.data.marry==null||obj.data.marry=="null"){
					$(".change2 .marry").hide();
				}else{
					$(".change2 .marry").show();
					$(".marry img").attr("src",obj.data.marry)
				}
				
				if(obj.data.death==null||obj.data.death=="null"){
					$(".change2 .death").hide();
				}else{
					$(".change2 .death").show();
					$(".death img").attr("src",obj.data.death)
				}
				if(obj.data.divorce_img==null||obj.data.divorce_img=="null"||obj.data.divorce_img.length==0){
					$(".change2 .divorce_img_box").hide();
				}else{
					$(".change2 .divorce_img_box").show();
					var str="";
					for (var i = 0; i < obj.data.divorce_img.length; i++) {
						if(obj.data.divorce_img.length==1){
							str=str+'<div class="pimgbox"><p class="otherszoop divorce_img">离异证明</p><div class="imgbox"><img src="'+obj.data.divorce_img[i]+'" /></div></div>';
						}else{
							str=str+'<div class="pimgbox"><p class="otherszoop divorce_img">离异证明'+(i+1)+'</p><div class="imgbox"><img src="'+obj.data.divorce_img[i]+'" /></div></div>';
						}
					}
					$(".change2 .divorce_img_box").append(str);
				}
				
				if(obj.data.child_img==null||obj.data.child_img=="null"||obj.data.child_img.length==0||ele.data.child.length==0){
					$(".change2 .childsimg").hide();
				}else{
					$(".change2 .childsimg").show();
					var str="";
					for (var i = 0; i < obj.data.child_img.length; i++) {
						str=str+'<div name="'+ele.data.child[i].name+'"   class="childsimgeq childsimgeq'+i+'" v="'+obj.data.child_img[i].accountBookpersonal+'" at="'+i+'"> <div  class="pimgbox"><p class="otherszoop child_img">子女'+(i+1)+'户口本个人页</p><div class="imgbox"><img src="'+obj.data.child_img[i].accountBookpersonal+'" /></div></div></div>';
					}
					$(".childsimgzoo").append(str);
				}
				
				
				var other=$("body").attr("other");
				if(obj.data.other_img==null||obj.data.other_img=="null"||obj.data.other_img.length==0||other==0){
					$(".change2 .othersimg").hide();
				}else{
					$(".change2 .othersimg").show();
					var str="";
					for (var i = 0; i < obj.data.other_img.length; i++) {
						str=str+'<div class="otherslist otherslist'+i+'" v="'+ele.data.other[i].name+'" at="'+i+'"> <div  class="pimgbox"><p class="otherszoop idCardfront">'+ele.data.other[i].name+'身份证正面</p><div class="imgbox"><img src="'+obj.data.other_img[i].idCardfront+'" /></div></div>';
						str=str+'<div class="pimgbox"><p class="otherszoop idCardback">'+ele.data.other[i].name+'身份证背面</p><div class="imgbox"><img src="'+obj.data.other_img[i].idCardback+'" /></div></div>';
						str=str+'<div class="pimgbox"><p class="otherszoop accountBook">'+ele.data.other[i].name+'户口本首页</p><div class="imgbox"><img src="'+obj.data.other_img[i].accountBook+'" /></div></div>';
						str=str+'<div class="pimgbox"><p class="otherszoop accountBookmain">'+ele.data.other[i].name+'户口本主页</p><div class="imgbox"><img src="'+obj.data.other_img[i].accountBookmain+'" /></div></div>';
						str=str+'<div class="pimgbox"><p class="otherszoop accountBookpersonal">'+ele.data.other[i].name+'户口本个人页</p><div class="imgbox"><img src="'+obj.data.other_img[i].accountBookpersonal+'" /></div></div></div>';
					}
					$(" .othersimgzoo").append(str);
				}
				
				
				if(haveHouse=='是'){
					var str="";
					for (var i = 0; i < obj.data.housing_situation.length; i++) {
						if(obj.data.housing_situation.length==1){
							str=str+'<div class="pimgbox"><p class="otherszoop housing_situation">杭州住房证明</p><div class="imgbox"><img  src="'+obj.data.housing_situation[i]+'"/></div></div>';
						}else{
							str=str+'<div class="pimgbox"><p class="otherszoop housing_situation">杭州住房证明'+(i+1)+'</p><div class="imgbox"><img src="'+obj.data.housing_situation[i]+'"/></div></div>';
					    }
					}
					$(" .othersimginfomore").append(str);
				}
				
				   
					
					
					
					
					if(obj.data.other_housing_situation==null||obj.data.other_housing_situation=="null"||obj.data.other_housing_situation.length==0){
					
					}else{
						 var str="";
						for (var i = 0; i < obj.data.other_housing_situation.length; i++) {
							if(obj.data.other_housing_situation.length==1){
								str=str+'<div class="pimgbox"><p class="otherszoop other_housing_situation">杭州四县住房证明</p><div class="imgbox"><img src="'+obj.data.other_housing_situation[i]+'"/></div></div>';
							}else{
								str=str+'<div class="pimgbox"><p class="otherszoop other_housing_situation">杭州四县住房证明'+(i+1)+'</p><div class="imgbox"><img src="'+obj.data.other_housing_situation[i]+'"/></div></div>';
						    }
						}
						$(" .othersimginfomore").append(str);
					}
					
					if(obj.data.personal_credit==null||obj.data.personal_credit=="null"||obj.data.personal_credit.length==0){
					
					}else{
						var down=$('body').attr('down')
						var pay=$('body').attr('pay')
						console.log(down)
						console.log(pay)
						if(down=='全款'&&pay=='一次性付款'){
							
						}else{
							var str="";
							for (var i = 0; i < obj.data.personal_credit.length; i++) {
								if(obj.data.personal_credit.length==1){
									str=str+'<div class="pimgbox"><p class="otherszoop personal_credit">征信证明</p><div class="imgbox"><img src="'+obj.data.personal_credit[i]+'"/></div></div>';
								}else{
									str=str+'<div class="pimgbox"><p class="otherszoop personal_credit">征信证明'+(i+1)+'</p><div class="imgbox"><img src="'+obj.data.personal_credit[i]+'"/></div></div>';
							    }
							}
							$(" .othersimginfomore").append(str);
						}
					}
					
					
					if(obj.data.fund_freezing==null||obj.data.fund_freezing=="null"||obj.data.fund_freezing.length==0){
					
					}else{
						 var str="";
						for (var i = 0; i < obj.data.fund_freezing.length; i++) {
							if(obj.data.fund_freezing.length==1){
								str=str+'<div class="pimgbox"><p class="otherszoop fund_freezing">银行存款证明</p><div class="imgbox"><img src="'+obj.data.fund_freezing[i]+'"/></div></div>';
							}else{
								str=str+'<div class="pimgbox"><p class="otherszoop fund_freezing">银行存款证明'+(i+1)+'</p><div class="imgbox"><img src="'+obj.data.fund_freezing[i]+'"/></div></div>';
						    }
						}
						$(" .othersimginfomore").append(str);
					}
					
					
					if(obj.data.security_img==null||obj.data.security_img=="null"||obj.data.security_img.length==0){
					
					}else{
						 var str="";
						for (var i = 0; i < obj.data.security_img.length; i++) {
							if(obj.data.security_img.length==1){
								str=str+'<div class="pimgbox"><p class="otherszoop security_img">社保证明或个税缴交证明</p><div class="imgbox"><img src="'+obj.data.security_img[i]+'"/></div></div>';
							}else{
								str=str+'<div class="pimgbox"><p class="otherszoop security_img">社保证明或个税缴交证明'+(i+1)+'</p><div class="imgbox"><img src="'+obj.data.security_img[i]+'"/></div></div>';
						    }
						}
						$(" .othersimginfomore").append(str);
					}
                   $(".headbox span").html(obj.data.status);
                   if(obj.data.status=="审核通过"){
                    	$(".seedataimg").show();
                   }
				if(obj.data.status=="审核不通过"){
					$(".reset").show();       
                    $(".weui-icon_msg.iconcolor").removeClass("weui-icon-info");
                    $(".weui-icon_msg.iconcolor").addClass("weui-icon-warn");
					if(obj.data.error==null){
//						return;
					}else{
						for (var i = 0; i < obj.data.error.length; i++) {
							if(obj.data.error[i].key=='personal_credit'||obj.data.error[i].key=='fund_freezing'||obj.data.error[i].key=='housing_situation'||obj.data.error[i].key=='divorce_img'||obj.data.error[i].key=='other_housing_situation'||obj.data.error[i].key=='security_img'){
								for (var e = 0; e < obj.data.error[i].reason.length; e++) {
									if(obj.data.error[i].reason[e]!=''){
										var pnode=$(".changebox2buyer .pimgbox ."+obj.data.error[i].key).eq(e).parent(".pimgbox").find("p").text();
								        var ptext=pnode+"(审核不通过原因:"+obj.data.error[i].reason[e]+")";
								        $(".changebox2buyer .pimgbox ."+obj.data.error[i].key).eq(e).parent(".pimgbox").find("p").text(ptext);
										$(".changebox2buyer .pimgbox ."+obj.data.error[i].key).eq(e).parent(".pimgbox").find("p").addClass("errorp");
										$(".changebox2buyer .pimgbox ."+obj.data.error[i].key).eq(e).parent(".pimgbox").find("img").addClass("redborder")
									}
								}
							}else{
								var pnode=$(".changebox2buyer .pimgbox ."+obj.data.error[i].key).parent(".pimgbox").find("p").text();
								var ptext=pnode+"(审核不通过原因:"+obj.data.error[i].reason+")";
								$(".changebox2buyer .pimgbox ."+obj.data.error[i].key).parent(".pimgbox").find("p").text(ptext);
								$(".changebox2buyer .pimgbox ."+obj.data.error[i].key).parent(".pimgbox").find("p").addClass("errorp");
								$(".changebox2buyer .pimgbox ."+obj.data.error[i].key).parent(".pimgbox").find("img").addClass("redborder")
							}
							
						}
					}
					
					console.log(obj.data.othererror)
					if(obj.data.othererror!=null&&obj.data.othererror!="null"){
						console.log($(".otherslist").eq(k).attr("v"))
							if(obj.data.othererror.length>0){
								for (var i = 0; i < obj.data.othererror.length; i++) {
									console.log($(".otherslist").eq(k).attr("v"))
									
									
									if(obj.data.othererror[i].key=='child_img'){
										  
										    for (var k = 0; k< $(".childsimgeq").length; k++) {
												console.log($(".childsimgeq").eq(k).attr("name"))
												if($(".childsimgeq").eq(k).attr("name")==obj.data.othererror[i].name){
													var at=$(".childsimgeq").eq(k).attr("at");
													console.log(at)
												var ptext=$(".childsimgeq"+at).find("."+obj.data.othererror[i].key).text();
												$(".childsimgeq"+at).find("."+obj.data.othererror[i].key).text(ptext+"(审核不通过原因:"+obj.data.othererror[i].reason+")");
												$(".childsimgeq"+at).find("."+obj.data.othererror[i].key).addClass("errorp");
												$(".childsimgeq"+at).find("."+obj.data.othererror[i].key).parent(".pimgbox").find("img").addClass("redborder");
													
												}
											}
										  
									}else{
									
										for (var k = 0; k< $(".otherslist").length; k++) {
											console.log($(".otherslist").eq(k).attr("v"))
											if($(".otherslist").eq(k).attr("v")==obj.data.othererror[i].name){
												var at=$(".otherslist").eq(k).attr("at");
												console.log(at)
											var ptext=$(".otherslist"+at).find("."+obj.data.othererror[i].key).text();
											$(".otherslist"+at).find("."+obj.data.othererror[i].key).text(ptext+"(审核不通过原因:"+obj.data.othererror[i].reason+")");
											$(".otherslist"+at).find("."+obj.data.othererror[i].key).addClass("errorp");
											$(".otherslist"+at).find("."+obj.data.othererror[i].key).parent(".pimgbox").find("img").addClass("redborder");
												
											}
										}
									
									
									}
									
								}
							}
					}
				}
			}else{
				$.alert(obj.msg,function(){
	            	if(obj.msg=='登录失效,请重新登录'){
								var v=Math.random();
							    window.location.href="login.html?v="+v;
				    }
	            });
			}
		},
		error:function(){
			$(".pagepre .btn").addClass("btnok");
            $.alert("请检查您的网络，稍后再试！","提示",function(){
            })
		}
	});		
}	
$(".reset").click(function(){
var phone=getlocalStorage("phone")
	$.ajax({
		url:posturl+"/api/sendAgain",
		type:"post",
		async:false,
		data:{
			"phone":phone
		},
		success:function(obj){
			console.log(obj)
			if(obj.code==200){
				window.location.replace("index.html");
			}else{
			   if(obj.msg=='登录失效,请重新登录'){
					var v=Math.random();
					window.location.href="login.html?v="+v;
				}
			}
		},
		error:function(){
            $.alert("请检查您的网络，稍后再试！","提示",function(){
            	
            })
		}
	});	
})

$(".change2").on("click",".imgbox img",function(){
	var src=$(this).attr("src");
	$(".zzc img").attr("src",src);
	$(".zzc").show();
})
$(".zzc").click(function(){
	$(this).hide();
})




})